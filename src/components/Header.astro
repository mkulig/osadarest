---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import Logo from "@assets/logo.svg";
import { SITE_TITLE } from "../consts";
import { toCardProps } from "../lib/apartments";
import HeaderLink from "./HeaderLink.astro";

const all = await getCollection("apartments");
const featured = all
	.filter((e) => e.data.featured)
	.sort((a, b) => a.data.order - b.data.order);

const items = featured.map(toCardProps);

const menu = [
	{ title: "Lokalizacja", href: "/#lokalizacja" },
	{ title: "Opinie", href: "/#opinie" },
	{ title: "Apartamenty", href: "/apartamenty" },
	...items.map((item) => ({
		title: item.title,
		href: `/apartamenty/${item.slug}`,
	})),
	{ title: "Blog", href: "/blog" },
];
---

<header class="sticky top-0 z-20 bg-white/95 backdrop-blur supports-backdrop-filter:bg-white/70 dark:bg-gray-900 shadow-sm dark:shadow-white/20">
    <nav class="container mx-auto flex items-center justify-between px-4 py-2 text-gray-900 dark:text-white" aria-label="Główna nawigacja">
        <a href="/">
            <Image src={Logo} alt={SITE_TITLE} class="w-32 py-1 dark:hidden" loading="eager"/>
            <strong class="hidden dark:inline">{SITE_TITLE}</strong>
        </a>

        <ul class="hidden md:flex items-center gap-8">
            {menu.map((link) => (
                <li>
                    <HeaderLink href={link.href} class="hover:text-gray-500/80 dark:hover:text-gray-300 transition p-2">{link.title}</HeaderLink>
                </li>
            ))}
        </ul>

        <a href="/rezerwacja" class="rounded-full px-4 py-1.5 hover:brightness-105 transition border-2 border-[#963f00] text-[#963f00] shadow-lg hover:scale-102">
            <strong>Rezerwacja</strong>
        </a>

        <button type="button" class="menu-btn md:hidden active:scale-90 transition" aria-label="Otwórz menu" aria-expanded="false" aria-controls="mobile-menu">
            <svg width="30" height="30" viewBox="0 0 30 30" class="fill-current" aria-hidden="true">
                <path d="M3 7a1 1 0 110 2h24a1 1 0 110-2H3zm0 7a1 1 0 110 2h24a1 1 0 110-2H3zm0 7a1 1 0 110 2h24a1 1 0 110-2H3z"/>
            </svg>
        </button>

        <ul id="mobile-menu" class="mobile-menu hidden absolute top-full left-0 w-full bg-white dark:bg-gray-900 p-6 flex-col space-y-4 text-lg md:hidden">
            {menu.map((link) => (
                <li>
                    <HeaderLink href={link.href} class="p-2">{link.title}</HeaderLink>
                </li>
            ))}
        </ul>
    </nav>
</header>

<script>
    document.querySelector('.menu-btn')?.addEventListener('click', (e) => {
        const btn = e.currentTarget;
        const menu = document.getElementById('mobile-menu');
        const isOpen = menu?.classList.toggle('hidden');
        btn.setAttribute('aria-expanded', !isOpen);
    });
</script>
