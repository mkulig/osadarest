---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import { toCardProps } from "../lib/apartments";

interface USP {
	icon?: string;
	text: string;
}

interface Props {
	placeName?: string;
	title?: string;
	intro?: string;
	usps?: USP[];
}

const {
	placeName,
	title,
	intro = "Kameralna osada z apartamentami w otoczeniu natury. Idealna na rodzinny wypoczynek, romantyczny weekend i dłuższe wakacje.",
	usps,
} = Astro.props;

const all = await getCollection("apartments");
const featured = all
	.filter((e) => e.data.featured)
	.sort((a, b) => a.data.order - b.data.order);

const items = featured.map(toCardProps);

const images = import.meta.glob<{ default: ImageMetadata }>(
	"/src/assets/*.{jpeg,jpg,png,gif}",
	{ eager: true, import: "default" },
);
for (const item of items) {
	if (!images[item.cover]) {
		throw new Error(
			`"${item.cover}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif}"`,
		);
	}
}
---

<section
  id="about"
  class="py-8 sm:py-10 lg:py-14"
  aria-labelledby="about-heading"
  itemscope
  itemtype="https://schema.org/LodgingBusiness"
>
  {/* nazwa dla schema.org, bez dublowania H1 */}
  <span class="sr-only" itemprop="name">{placeName}</span>

  <div class="mx-auto grid container grid-cols-1 items-center gap-6 px-4 sm:gap-8 sm:px-6 lg:grid-cols-2 lg:gap-12 lg:px-8">
      <div class="flex items-center gap-2 h-[400px] w-full mt-10 mx-auto">
          {items.map((item) => (
              <div class="relative group flex-grow transition-all w-56 rounded-lg overflow-hidden h-[400px] duration-500 hover:w-full">
                  <Image class="h-full w-full object-cover object-center"
                      src={images[item.cover]}
                      alt={item.coverAlt}
                      />
              </div>
          ))}

      </div>

    <div class="mx-auto w-full max-w-xl">
      <h2 id="about-heading" class="text-2xl font-semibold tracking-tight text-gray-900 sm:text-3xl">
        {title}
      </h2>

      <p class="mt-3 text-base text-gray-700" itemprop="description">
        {intro}
      </p>

      {usps?.length > 0 && (
        <ul class="mt-5 grid list-none grid-cols-1 gap-3 p-0 sm:grid-cols-2">
          {usps.map((u) => (
            <li class="flex items-start gap-2 text-gray-800">
              {u.icon && <span class="text-lg leading-none" aria-hidden="true">{u.icon}</span>}
              <span class="text-sm">{u.text}</span>
            </li>
          ))}
        </ul>
      )}

    </div>
  </div>
</section>
